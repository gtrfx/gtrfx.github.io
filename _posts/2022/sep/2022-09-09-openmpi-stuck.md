---
title: "openmpi가 말을 잘 안들을 때"
tags: [openmpi]
layout: post
author: "Keith"
---

OpenMPI가 매우 유용한 툴인데 가끔씩 문제가 생기면 해결하기 쉽지 않은 경우가 있어 정리해보기로 한다.

1. 특정 프로세스가 dormant 상태로 빠져버리는 경우

신기하게도 openmpi로 실행하는 worker host에서 job이 dormant로 빠져버리는 경우가 있다. 전혀 이유를 알 수 없고 이러한 경우 정말 다양한 방법을 다 사용해보게 된다.

일단 문제가 무엇이든간에 worker host를 일단 리부트하는 것을 추천한다. 리부트가 불가하다면 사실 그 이후에 어떤 방법으로 문제를 들여다보든 답을 얻기 쉽지 않다고 말해두고 싶다.

openmpi로 묶어놓은 머신들이 다수에 의해 공유되고 있는 경우, 어떠한 이유로든 문제가 발생할 수 있고 그게 쉽게 모니터링 될 수 없기 때문에 어느 날 갑자기 잘 돌던 프로세스들이 멍해졌다면 리부트 해보는 것을 권할 수 밖에 없다. 이게 불가하다면 openmpi-default-hostfile을 건드려서 의심되는 머신들을 제외시킨 후에 돌려보는 것도 괜찮은 방법이다. 

내 경우 특정 머신에서 segfault가 계속해서 발생했는데 위의 방법을 통해서 쉽게 해결했다. 

대개 의심이 가는 부분은 global variable에 일부 process가 의존한다거나 아니면 의도치 않게 stdout으로 뭔가를 내보내고 있다거나 하는 경우 등등인데, 원인은 워낙 다양하기 때문에 반드시 이것 때문이다 라고 말하기는 쉽지 않다.

2. 특정 머신에서 error가 생긴다고 report 되는 경우

이 경우는 더 생각하고 말것도 없이 해당 machine을 reboot하는 것이 빠르다. 기왕이면 최신 상태로 업데이트 하는 것도 괜찮다. 사실 이렇게 되면 그리드에 묶여있는 모든 머신들을 한꺼번에 업데이트 해야겠지만.

3. 거의 모든 parallel job이 종료되었음에도 main job이 종료되지 않는 경우

여러 가지 이유가 있는데 대표적인 것이 뭔가 불필요한 standard output이 발생하는 경우이다. 쓸데없이 화면에 프린트하지 않도록 하자. 또 한 가지 stupid한 자가 file writing을 하는 경우 문제가 발생할 수 있다. stdout이든 stderr이든 file이든 모두 비슷한 경우라고 볼 수 있으니까 빠짐없이 체크해 보도록 하자.

