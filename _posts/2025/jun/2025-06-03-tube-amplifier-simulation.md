---
title: "진공관 앰프 시뮬레이션..."
tags: [audvans]
layout: post
author: "Keith"
---

진공관 앰프를 pspice로 한참 시뮬레이셔 해보다가 12ax7 3개로 프리앰프도 만들어보고 그러다가 플러그인을 만들기 시작한 게 2013년 경인 것 같다.
대략 6개월 정도 하다가 중단하고 12년이나 지난 지금 다시 시작하게 되었다.

다시 돌아오면서 느낀 점은 이거다.
- feedback loop를 제대로 만들어야 시뮬레이션을 한 보람이 생긴다.
- nonlinearity를 digital 영역에서 반영하면 aliasing이 생기는데, high gain으로 가면 이게 굉장히 톤을 지저분하게 만든다.
- aliasing을 해소하려면 oversampling + filter으로 승부를 봐야하는데 계산량이 급격히 증가하는 것을 피하기가 쉽지 않다. 
- feedback loop를 디지털 영역에서 잘 구현하려면 필터링에 의한 delay/latency가 없어야 하는데 이걸 피할 방법이 없다. 뭘로 만들든 발진을 한다ㅠ

먼저, 왜 feedback loop를 잘만들어야 하나?

power amplifier는 대개 class AB (push-pull) 앰프로 만든다. 
이런 증폭 방식은 증폭단 두개를 가지고 +와 -영역을 각각 증폭해서 앰프 효율을 늘리는 방법이다.
이때 각각의 증폭단에 양파(정위상 입력, 반전위상 입력)로 입력 한다. 

그런데 옛날 진공관 앰프에서는 정위상/역위상 신호를 정확하게 만들지 못하니까 
출력 증폭단 바로 앞에 놓이게 되는 phase splitter (정위상/역위상의 입력을 만들어주는 부분)가 있다. 
원래 목표는 한쪽은 정위상 신호를 넣고 반대쪽은 출력단에서 역위상으로 나타나는 전압을 잡아서 넣는다.

feedback network이 이상적이라고 하면 시스템이 빠르게 안정되면서
프리앰프 출력의 정위상/역위상 버전이 각각 들어가면서 약간 낮은 증폭률로 안정되게 된다.
다시 말해 입력단으로 피드백된 결과는 프리앰프 출력이 역상된 결과가 되는 것으로 수렴한다.

만약 출력단의 (피드백이 없을 때의) 이득이 A이고 feedback network의 이득이 B, 그리고 프리앰프의 출력을 x라고 하면,
feedback 되어 돌아온 신호는 -ABx가 된다. closed loop gain은 결국 A/(1+AB)=A/2이 된다.
open-loop gain보다는 줄어들지만 앰프의 발진을 막아준다. 

feedback loop는 R/C로 구성되는 약간의 필터(EQ)로 구성되기도 하고 그냥 분압만 하는 경우도 있다.
대개 필터는 low pass filter가 되는데, 출력에 low pass filter가 걸린 것이 다시 입력으로 들어오게 되므로
시스템이 수렴하게 되면 low pass filter로 감쇄된 영역이 부스트된 결과가 출력으로 나가게 된다.

문제는 진공관 앰프의 출력단에서도 왜곡이 일어나기 때문에 feedback이 일어나게 될 때는 이 이상적인 경우에서 벗어나게 된다.
다시 말해 정위상은 프리앰프의 출력이 들어가고 피드백되어 돌아오는 신호는 파워앰프에서 찌그러진 신호가 돌아오게 되기 때문에
찌그러질 때마다 계속해서 transient가 일어나게 된다. 
