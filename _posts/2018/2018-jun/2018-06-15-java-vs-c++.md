---
layout: post
title: "Java vs C++: 속도 비교"
categories:
    - computer
---

재미삼아 C/C++를 자바로 옮겨 테스트해보고 있다. 과연 속도가 빨라야 하는 안드로이드 애플리케이션을 자바로 만들어서 돌려도 되나 알아보고 싶은 맘에서.

예전엔 대략 4-5배정도 시간이 더 들었던 것 같은데, 4096 point FFT를 (비교적 코드 자체도 최적화가된) 10000번 돌려보는 것으로 체크해보니, 옛날 머신에서 옛날 JRE로 돌렸을 때 대략 3배 정도 더 많은 시간이 걸렸다. 어디에서? 자바 애플리케이션에서.

내가 사용하는 랩탑에서 MacOS 상에서 돌려보면 대략 2배가 조금 넘게 더 걸리는 것으로 나타난다. 리얼타임으로 돌아가야 되는 오디오 시그널 프로세싱이라고 하면 FFT보다 더 하면 더했지 덜하지 않을텐데 NDK로 C/C++을 이용할 수 밖에 없겠다는 답은 나온다. 남이 쓸 것이라면 모르되 내가 쓰는 게 되면 느려터진다거나 시스템 부하를 많이 먹는 것은 용납이 안되지 싶다.

자바를 관심가지고 본 것은 처음인데 수많은 라이브러리가 있고 오랜 시간 발전했다고 생각했는데, complex class도 없고 생각보다 미비한 구석이 제법 많았다. 물론 이게 다른 세계로 들어가면 얘기가 분명히 달라질 거라고 본다. garbage collection을 개발자가 신경 쓸 이유가 없는 것은 좋은데, 데이터의 전달이 value가 아닌 reference로 되고 있어서 '='로 뭔가를 대입한다거나 해야할 때 개념의 착오가 자꾸 일어나게 된다.

분명히 value를 전달한 것 같은데 reference가 전달되거나 그 반대의 경우이거나 하는 것 말이다. C++에서도 STL을 쓰면 사실 garbage collection은 덜 신경써도 되는 상황인데 그런 의미에서 iOS와 안드로이드 앱을 동시 개발해야 된다고 놓고 보면 core는 C/C++이 되고 나머지 부분만 해당 플랫폼에 맞게 개발하는 식으로 가는 게 아닐까 한다. 만약 같은 앱을 일반 PC 상에서도 만들어야 한다면 더 볼 것도 없는 것 아닐까 하는 생각도 들고.

그러니까 세상이 많이 변해서 java처럼 VM위에서 돌아가는 것은 어디에 가져다놓아도 다 실행할 수 있게끔 되는 것 같지만, 성능 문제 - 특히 속도와 배터리 소모 - 가 결부되면 결국 다시 C/C++ 심하면 assembly 수준으로 내려가게 되어야 하는 것은 예나 별 차이 없는 것 아닐까 하는 것이다.

PS: 같은 버전의 JRE를 받아서 같은 하드웨어 상에서 Mac/Windows에서 돌려봤는데 Windows에서 걸리는 시간이 훨씬 더 많이 나타난다. 비주얼 스튜디오에서 64bit으로 빌드하면 Xcode에서 O3로 빌드하는 것이나 시간 차이는 거의 나지 않는 것에 비하면 이해하기 어려운 상황인데, 그 얘기라면 자바 애플리케이션은 맥에서 월등히 빠르게 돌아간다는 이야기가 될 뿐이다.

마찬가지로 우분투에서 돌려봤을 때는 자바는 MacOS와 비슷하고 c++은 시간이 대략 25% 정도 줄게 나타난 것으로 보면 역시 llvm보다는 g++이 더 높은 성능을 내는 것으로 봐도 되지 싶다. 

추가..

arch linux에서 openjdk10으로 compile/run 해본 결과 C++대비 5배 더 많은 시간이 걸렸다. 그러니까 거꾸로 보면 C++이 java대비 5배 빠르다. java는 계산이 많이 필요하지 않은 일 - user interface(??)에 적당한 언어라고 봐도 되는 것인가? python에 비하면 엄청나게 빠른 것이니까 나름대로의 용도를 인정해주어야 맞을 듯 하다.