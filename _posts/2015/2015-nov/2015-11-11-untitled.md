---
layout: post
title: "Power amplifier feedback..이거 어떻게 제대로 흉내낼까?"
---

파워앰프 시뮬레이터라고 하면 인터넷에서 구할 수 있는 것은 IgniteAmp의 TPA-1이라는 것이 있다. 모양은 2:90처럼 생겨서는 왠만한 tube power amplifier가 갖춰야 할 요소들은 거의 다 가지고 있다. 그러나, 이것을 연결했을 때와 그렇지 않았을 때의 차이점은 도무지 느낄 수가 없다. 다만, 여기에 구현되어있다고 하는 speaker impedeance에 대한 요소가 있는데, 그것은 resonance라는 항목으로 반영되어있으나 이 역시 톤에 어떤 영향을 미치는지 노브를 아무리 돌려봐도 차이가 거의 느껴지지 않는 것이다.꼭 찝어서 뭔가 영향을 주는 요소라고 해봐야 presence 정도이고, 연결하면 음량이 약간 증가하고 저음과 고음부가 왠지 증가한 느낌? 이것은 speaker impedence를 약간 반영해서 그런 것 같다고 할 수 있겠다. 그 외에는 하모닉이 더 늘었다 하는 느낌도 없도 실제로 preamp+poweramp를 정교하게 모델한 콤보 앰프 모델처럼 프리+파워를 별도로 연결해놓아도 전혀 똑같지도 않고 단지 선택항목들 (power tubes, bias)만 많다고 감히 얘기할 수 있겠다.엄밀히 말해서 기타 앰프의 power amplifer는 phase splitter와 power amplifier 찌그러짐, 그리고 speaker impedence에 의한 영향을 컨트롤하는 feedback (presence/contour 혹은 resonance/depth등의 요소)이 반영되어있어야 제대로 된 파워앰프 시뮬레이션이라 할 수 있다. 출력 트랜스포머라든가 전원 (tube rectifier인지 silicon rectifier인지, 또 power supply의 impedence) 시뮬레이션까지 해주면 정말 제대로 되었다할 수 있겠지만 여기까진 아니더라도 말이다.이미 스피커의 임피던스를 반영하는 것에 대해서는 언급한 바가 있고, 구체적인 스피커 모델에 따라 resonance frequency, 그리고 10kHz에서의 impedence를 알고 있으면 큰 무리없이 모델링이 가능하다. IR을 어떻게 측정했느냐가 사실 이 모델링의 정확도보다 더 중요하다고 본다.가장 문제가 되는 것은 feedback이다. 단도직입적으로 애기하면, 다음과 같은 점이 큰 문제가 된다.* discrete한 digital signal을 가지고 feedback회로를 샘플단위로 구현하게 되면 빛의 속도로 구동되는 아날로그회로와 같은 응답을 얻을 수가 없다. * Phase splitter에서 feedback은 inverted phase input에 작용한다. 원래 설계가 그렇다. feedback은 positive이지만 inverted input에 더해지므로 negative feedback이 되는 것이다. * Feedback의 양이 정확하지 않다. 실제로 output transformer, output load, power tube gain등이 앰프를 어떻게 만들었느냐에 따라 같은 모델이라도 다 다르기 때문에 원래 어느 정도의 출력이 되물림되는지 회로도만으로는 제대로 구할 수가 없다. * 그렇다고 모든 회로를 통째로 filter로 묶게 되면 phase splitter, power tube pair의 non-linearity를 반영할 방법이 없다.다른 simulator는 어떻게 했느냐? 알아보면* 대부분의 시뮬레이터는 EQ로 떼우고 있다고 보면 된다. Presence도 EQ, Resonance도 EQ, speaker impedence도 EQ, 나머지 power amplifier의 요소는 반영하지 않는다.* Axe Fx의 경우에는 파워앰프 구성 요소를 요소별로 쪼개어 설정가능하게 했지만 이 역시도 general model일 뿐 앰프 기종에 따른 feedback scheme, 또 phase splitter/power tube 특성을 반영한 feedback loop를 구현한 것은 아니다.Kemper의 경우는 nonlinearity가 있는 시스템의 snapshot을 찍은 것이므로, 현재의 앰프 설정을 그대로 반영할 뿐이지 이것들을 tweak할 수는 없다. 앰프 특성의 snapshot에 general한 EQ라든가 input gain control 이 정도가 전부라고 봐야 한다.그렇다면 얼마나 작은 출혈로 가장 비슷하게 만들어 볼 수 있을까?closed loop gain으로 출력하게 하되, open loop으로 구동시키고 nonlinearity를 반영하는 것이다. Distortion이 있을 때의 feedback loop의 구동 방법과는 다르지만, 실제 앰프와 얼추 비슷한 응답을 얻을 수 있다.1안은 다음의 수식을 이용하잔 것이다. $$ G_O ( \omega ) = \frac{ A_O (\omega) }{ 1 + A_O (\omega) A_F (\omega) }$$여기서, open loop gain을 빼버리면 open loop의 입력으로 들어가는 신호의 gain은 다음과 같이 구하는 것이다.$$ G_\{what?\} (\omega) = \frac{1}{1+ A_O (\omega) A_F (\omega)} $$이미 대충 계산해 본 바에 따르면 파워앰프 게인을 상수로 맞추더라도 speaker impedence가 최소 3차의 filter가 되고, feedback loop의 경우는 아무리 못해도 1차가 되므로 전체적으로 이 filter는 4차가 되므로 구현하기 그다지 좋은 폼은 아니다. 여기에 resonance까지 붙고 하다보면 5차가 돌 것 같은데, 어쨋든 이 방법이 가장 실현 가능성이 높아보인다. 이것을 피하려면 oversampling을 좀 많이 해서 실제로 sample간의 phase가 어긋나더라도 그 차이가 작아지도록 조작해서 nonlinearity가 없는 loop를 돌린 뒤에 출력단으로 내보내는 방법이 있다. 즉, 입력을 가지고 nonlinearlity가 없는 open loop 출력 (증폭률 x 스피커 임피던스)을 만들고 여기에 feedback filter를 씌운 결과를 입력에서 뺀 뒤에 실제의 출력단에 내보내는 것이다. 위 방법이나 아래 방법이나 거지같긴 마찬가지지만 후자가 가장 덜 복잡하면서도 제법 그럴싸하게 돌릴 수 있는 방법이긴 하다. 아날로그 세계에선 불가능하지만 (그럴 필요가 없으므로) 디지털 세계에선 가능하다.

