---
title: "GLIBC의 호환성 문제는 어떻게 극복해야 하나?"
tags: [glibc, linux]
---

glibc는 gnu c library를 의미한다. 이게 왜 중요하냐 하면 linux 위에서 돌아가는 거의 대부분의 소프트웨어가 여기에 기반하고 있기 때문이다. 

이게 소리인지 또 이해를 못 할 수도 있으니 덧붙여보면, 우리가 사용하는 소프트웨어, 하다못해 내가 만들어놓은 것이라고 하더라도 그것이 C를 이용해서 개발되었거나, 그것의 구성품 중 하나라도 C를 이용해서 개발했을테니까 결국 glibc (libc)안에 들어있는 함수를 불러낼 수 밖에 없다. 이것은 동적 라이브러리(so)의 형태로 존재하고 그것을 ld가 찾아서 불러다 주게 되어있다. 따라서, 리눅스 시스템에서 보면 커널 다음으로 중요한 요소라고 볼 수 있다. 또 이것의 버전이 무엇이냐에 따라서 사실상 그 배포판이 얼마나 진보된 것인지 결정이 된다고 볼 수 있다.

즉,

리눅스 배포판에 달라붙는 버전의 큰 번호가 있는데, 그게 대충 6이라고 보면 glibc의 버전은 2.12 정도라고 보면 되고
7로 올라가면 2.17, 8, .. 이런 식으로 가게 된다. 

지금 최신 리눅스로 취급받는 것들은 대략 2.3x대 Glibc 버전을 사용하고 있다고 보면 된다. 우분투 같으면 14.04만 되도 2.17, 16.04는 2.21, 최근 버전인 20.04에는 2.3x대 버전을 쓰고 있다. 

따라서, 다른 곳에서 빌드된 라이브러리나 소프트웨어를 가져다가 실행한다고 보면, 내 리눅스의 glibc 버전이 높으면 실행하는데 아무런 문제가 없다. 즉 glic가 하위버전에 대한 호환성을 가지고 있어서 최신 Linux는 구형 linux에서 빌드된 소프트웨어를 문제없이 사용할 수 있는데, 문제는 그 반대의 경우이다. 

이러한 경우, 구형 리눅스를 사용하는 이들이 내가 빌드하는 소프트웨어의 glibc 버전을 낮춰달라고 요청할 수 있다. 

이때 어떻게 해야 되는가?

내 시스템에서 구버전의 glibc를 빌드하고 그것을 실험적으로 사용해서 빌드할 수도 있다. 그러나, 이것은 내가 빌드하는 모든 소프트웨어가 같은 버전의 glibc를 참조한다고 보장할 수는 없다. 또 그 소프트웨어를 내 환경에서 동작시키면 혹시나 높은 버전의 glibc 함수를 부르더라도 문제없이 실행되므로 문제를 찾아내기 힘들다.

답은 뻔하다. 구형 리눅스 docker image를 가져와서 새로 빌드하는 수 밖에 없다. 당연히 GCC 버전도 낮아지고 glibc 버전도 낮아지고 다 버전이 낮아진다. 대신 호환성은 높아진다. 결과물의 크기도 커지는데, 수행속도는 느려진다. 그만큼 gcc/g++/glibc의 성능이 그동안 많이 개선되었다는 말이다.

gcc 4대의 결과물과 9.x (10은 말할 것도 없다)대의 결과물의 수행속도 차이는 정말 엄청나다. 물론 그동안 새로 확장된 CPU instruction (SSE/AVX)를 더 많이 사용할 수 있기 때문이라고 본다. 그만큼 구형 gcc/g++/glibc를 쓰면 최신 CPU의 확장된 기능을 모두 쓸 수 없게 된다는 말이나 같은 말이다. (그런데, enterprise linux를 쓰는 놈들이 그 기능을 요구하는 놈들이 많다.)

