---
title: "Ryzen 헤드리스 리눅스 박스?"
layout: post
tags: [linux, ryzen, headless]
---

결론부터 이야기하면 UEFI Bios 때문에 안된다.

GPU 가격이 금값인데 사실 deep learning을 한다거나 고사양 게임을 하는 게 아니면 또 쓰임새가 별로 없는 게 GPU다. 일반작업을 할 때에는 그저 간단히 프레임버퍼 기능 + VP9 디코더 정도만 하면 되기 때문이다. GPU가 좋지 않으면 단순히 프레임버퍼 노릇만 하고 나머지는 모두 소프트웨어가 하도록 되어있다.

M1 mac mini를 구입하기 전부터 생각했던 것이지만, 사실 이 물건을 주로 사용하게 되니 그전에 가지고 있던 PC는 가끔씩 x86 리눅스 혹은 윈도우즈를 쓸 때에만 활용한다. 결국 GPU가 필요없게 된 것이다. 지금 GPU 수급 문제로 가격이 매우 좋아서 투자금을 회수하기 좋은 상황이라 headless 구성 (GPU가 없는 구성)을 해봤으나 BIOS에서 GPU가 없으면 부팅과정을 진행시키지 않는다.

최근에 비트코인이 거의 폭락하고 있는 상황이라 GPU를 빨리 처분해야지 하고 있다. 그래서 간신히 4k가 되는 구형 GPU를 하나 주문했다. UEFI Bios가 허용하지 않아서 Headless 구성이 안되고 있으니까.

다행스러운 것은 
- VM 전용 머신으로 쓰기에 2700X가 아직 매우 훌륭하다: docker container들도 빨리 돌아가고 여기에 windows까지 qemu로 올려놓아도 전혀 답답할 일이 없다. 
- docker container 각각에서 X를 띄우거나 windows를 RDP로 접속해도 전혀 답답하지 않다. 4k로 구동해도 꽤 빠르다. 다만 화면을 lossy 압축해서 전송하는 관계로 화질이 100% 완벽하다고 볼 수 없는 것이지만. 이런 것들 사실 다 상관없다. 
- linux를 main os로 하면 boot up/shutdown이 매우 빨라서 나처럼 성질 급한 사람들에게 딱 어울리는 장비다.

생각해보니 조립한지 2년 되가는 이 물건도 GPU를 처분해버려도 잔존가치가 대충 500불은 남아있는 물건인데 (같은 비용으로 이 정도의 물건을 조립할 수 없다.) 이런 용도 (VM, 원격데스크탑)으로 보면 3천불 정도의 workstation 정도의 쓰임새 (속도는 비교가 어렵고)를 가지고 있다고 봐야지 싶다.

실제로 Xeon이 여러 개 붙은 회사 웍스테이션들은 대부분 놀고 있다. 대부분 20 core 이상인 시스템이지만, 사람들이 들어가서 작업을 하더라도 그다지 많은 core를 쓰지 않을 뿐더러. 병렬처리를 하게 되는 경우에 모든 core를 전부 다 쓰는 경우에는 시스템이 과열되어 망가지는 경험을 했던 터라 그렇게 잘 사용하지 않는다. 

대부분 내 사용 예에서는 모든 core를 전부 사용해서 최대한 빨리 결과물을 얻는 방향으로 일을 진행하는데, 이때 시스템 로드가 100%까지 올라간다. 그것도 여러 날. 이러다가 머신이 뻗어서 수리를 하게 되는 경우에는 대략 보름 이상의 시간이 날아가기 때문에 차라리 load를 절반만 걸어놓고 사용하는 게 낫다. 

내가 처음 병렬 시뮬레이션을 하던 시절을 떠올리면 사실 대략 20대의 4 core Xeon x 2 (16 threads) 머신을 한 방에 몰아넣고 운용했을 땐데, 지금은 2천불 대의 threadripper만 사더라도 32core (64 threads)이고 성능은 최소한 4배 정도로 올라서 사실 이런 웍스테이션 4대 정도만 있어도 예전의 시뮬레이션은 비슷한 시간에 결과를 뽑아낼 수 있다. 

문제는 지금은 많은 사람들이 같이 들어와서 일을 하고 있어서, 속도 문제는 둘째치고 ㅂㅅ처럼 일하는 이들 덕택에 아무리 code analyzer/memory checker로 뒤져봐도 문제가 안보이더라도 언제 사고가 날지 모르는 상황이라 예전같은 짜릿함은 찾아볼 수가 없다.

아무리 컴퓨터 자원이 좋아도 중간 죽어버리면 그 역시도 아무 의미없다. 

도무지 그런 수준으로 일하면서 제대로 테스트도 안해보고 commit하는 용기는 어디서 나오는지.