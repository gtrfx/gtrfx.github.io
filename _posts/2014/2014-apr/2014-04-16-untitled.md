---
layout: post
title: "Accurate Plate Follower C Model…(4)"
---


이쯤해서 나름 길게 끌어온 내용에 대해서 정리를 해야할 것 같다. 




1) Accurate하다는 게 무엇인가?




실제 tube의 data sheet의 특성 곡선을 가장 잘 묘사하는 implicit function으로 만들어진 tube model을 이용했다는 뜻이다. 이 모델들은 3단자 혹은 4단자에 전압 값을 넣어주면 실제 벌겋게 달궈진 tube처럼 어느 정도의 전류를 흘리게 되는지 실제와 거의 비슷하게 알려준다. 




2) 그냥 회로를 해석해서 그 결과만 쓰면 되지 왜 거창하게 모델링이니 뭐니 하는 것인가?




3단자 혹은 4단자 진공관 모델은 이들 입력 변수 (전압)들에 대해서 1개 혹은 2개의 응답을 내는 implicit function이라 우리가 linear circuit에서 흔히 다루는 회로와 다르다. 즉, 진공관 단자에 걸리는 전압을 명시하면 해당 단자로 나오는 전류를 알려주는데, 실제의 회로에서 전류값을 모르고 전압을 계산할 수 없고, 전압을 모르고 전류를 알 수가 없기 때문에 3단자에 들어가는 전압값을 사실상 찍어주어야 한다. 그 값을 가지고 전류를 구하고 구해진 전류로 다시 전압값을 계산해 나가고, 이 때 생긴 오차를 가지고 여러 번 iteration을 해야한다. 그래서 한눈에 해석이 안된다. 그래서 small signal model이니 하는 것들을 쓴다. 이 모델은 정상적인 동작범위에 일부만을 놓고 쉬운 수식으로 만들어놓은 것이라 모델이 보장하는 동작 범위를 벗어나면 큰 오차가 생긴다. 불행히도 기타 앰프는 일반적인 hifi amplifier를 위한 진공관 입력범위를 넘어서는 범위의 입력을 바탕으로 동작하기 때문에 small signal model을 쓰기 어려운 것이다. 




사실상 여러번 iteration하면서 회로를 분석하는 단계가 되면 spice와 유사한 오차 범위로 시뮬레이션 할 수 있다.




3) 꼭 accurate하게 할 필요가 있는 건가?




여태 수많은 회사에서 기타 앰프를 시뮬레이트 하려고 많은 아이디어를 내었지만, 그럴싸한 소리를 내는 것은 극히 일부이다. 그 얘기는 low end에서는 진공관의 흉내를 대충 내서 찌그러뜨리고 그럴싸한 필터나 여러 단 갖다 붙이는 것 (이것도 사실 힘든 일이다)으로 끝날 것 같지만, 비선형 신호 왜곡이 다단으로 일어나는 데다 그것이 생각만큼 그렇게 단순하지 않아서 1단을 아무리 잘 모델링했더라도 2단 3단으로 걸쳐 오면서 원본과의 차이가 점점 늘어다나보니 사실상 가장 마지막에 얻어지는 결과는 원본과 흉내낸 것과 같아질 수 없다는 말이다. 




4) 실시간으로 구동시킨다면 그 원리는 어떻게 되는 것인가?




매 sampling interval마다 모든 회로를 시뮬레이션 하는 것은 엄청난 계산량 때문에 불가능하다. 가장 잘 알려진 것은 2개의 증폭단씩 시뮬레이션 하는 것이다. 다음 단으로 이동할 때 1개 증폭단씩 오버랩하면서 말이다. 이렇게 하면 실제로 전체 회로를 전부 시뮬레이션한 것과 거의 비슷한 결과를 얻게 된다고 한다. 그 이유는 grid에 current가 흐르기 때문이다. 즉, 1개 증폭단의 출력 전압에 따라 다음 증폭단으로 흘러들어가는 전류가 결정되고, 그에 따라 출력 전압이 달라지게 되므로, 1단을 분석하더라도 최소 2단의 증폭단을 고려해야 결과를 얻을 수 있다.




따라서, 실시간 구동은 다음과 같은 형식으로 이루어질 것이다.




- 새로운 입력과 과거의 상태를 조합하여 진공관 입력 전압을 계산한다. (이것은 정확한 값이 아니라 일종의 첫 추정치이다)

- 진공관 입력전압을 바탕으로 전류 값을 구한다. 이 과정에서 iteration이 일어난다. Sampling rate에 따라 iteration 회수는 줄어든다.

- 전류값으로 회로 상태를 update한다.




그러면 본격적인 실시간 모델을 위한 최적화를 진행해보기로 하자.





